function import$(e,t){var s={}.hasOwnProperty;for(var a in t)s.call(t,a)&&(e[a]=t[a]);return e}var zIndex,classMap,state,view,renderPlayer,firekey,player,field,sample,res$,i$,to$,f,lresult$,j$,to1$,h,lresult1$,k$,to2$,w,n,loadLevel;for(zIndex=function(e){var t,s,a;return e.x,t=e.y,s=e.f,a=e.p,2*(s*state.dim.w*state.dim.h+t)+(a?1:0)},classMap={0:"void",1:"bedrock",2:"earth",3:"wall",4:"stool",5:"grass",6:"door",7:"key",8:"exit",9:"stair",10:"gravel",500:"sapphire"},state={player:{x:1,y:1,f:2,item:[]},dim:{size:32,vp:12},nodes:[],tiles:[[[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1]],[[9,2,2,2,2,2,2,2],[0,2,2,2,2,2,2,2],[0,2,2,2,2,2,2,0],[0,2,2,2,2,2,2,2],[0,2,2,2,2,2,2,2],[0,2,2,2,2,2,0,2],[0,2,2,2,2,2,2,2],[9,2,2,2,2,2,2,2]],[[0,0,3,3,0,0,0,0],[0,0,0,5,0,0,4,0],[0,4,0,3,0,0,3,0],[0,10,3,3,0,3,0,0],[0,0,3,0,4,0,5,0],[0,7,3,0,0,3,0,3],[0,3,3,0,0,3,6,3],[0,0,0,0,0,3,500,3]]]},state.dim.f=state.tiles.length,state.dim.h=state.tiles[0].length,state.dim.w=state.tiles[0][0].length,view=new ldView({root:document.body,handler:{field:function(){},sample:function(){},player:function(){}}}),renderPlayer=function(){return import$(player.style,{left:state.player.x*state.dim.size+"px",top:state.player.y*state.dim.size-state.player.f*state.dim.vp+"px",zIndex:zIndex({f:state.player.f,y:state.player.y,x:state.player.x,p:1})})},firekey=function(e){var t,s,a,i,l,r,n,d,o,p,f,m,y,$,c,u,v,h,x,w,k,z,g,M,L,I,N;if((t=state.player).moving&&(!t.lastMoveTime||e-t.lastMoveTime>100)){switch(t.lastMoveTime=e,s={x:t.x,y:t.y,f:t.f},t.dir){case 0:i=(a=[-1,0])[0],l=a[1];break;case 1:i=(a=[0,-1])[0],l=a[1];break;case 2:i=(a=[1,0])[0],l=a[1];break;case 3:i=(a=[0,1])[0],l=a[1]}if(!(isNaN(i)||(r={x:s.x+i,y:s.y+l,f:s.f},a=[t.x+i,t.y+l,s.f],n=a[0],d=a[1],o=a[2],a=[n+i,d+l,o],p=a[0],f=a[1],m=a[2],n<0||n>=state.dim.w||d<0||d>=state.dim.h||o<0))){if(y=state.tiles[t.f]?state.tiles[t.f][t.y][t.x]:0,$=state.tiles[o]?state.tiles[o][d][n]:0,c=o>0?state.tiles[o-1][d][n]:1,0!==(state.tiles[o+1]?state.tiles[o+1][d][n]:0)||1!==$&&2!==$&&3!==$||9!==y||(r.f=r.f+1,m=o=r.f,y=state.tiles[t.f][t.y][t.x],$=state.tiles[o]?state.tiles[o][d][n]:0,c=o>0?state.tiles[o-1][d][n]:1),1===$||2===$||3===$||5===$);else if(0===$&&9===c)r.f=r.f-1,import$(t,r);else if(7===$)for(state.player.item.push(7),state.tiles[o][d][n]=0,state.nodes[o][d][n].parentNode.removeChild(state.nodes[o][d][n]),import$(t,r),u=0,v=state.dim.f;u<v;++u)for(h=u,x=0,w=state.dim.h;x<w;++x)for(k=x,z=0,g=state.dim.w;z<g;++z)M=z,6===state.tiles[h][k][M]&&(state.tiles[h][k][M]=8,state.nodes[h][k][M].classList.remove(classMap[6]),state.nodes[h][k][M].classList.add(classMap[8]));else 500===$?(state.tiles[o][d][n]=0,state.nodes[o][d][n].parentNode.removeChild(state.nodes[o][d][n]),import$(t,r)):4===$?0!==(a=state.tiles[o][f][p])&&5!==a||state.tiles[o-1]&&9===state.tiles[o-1][f][p]||(m=o+(L=o>0&&0===state.tiles[o-1][f][p]?-1:0),state.tiles[o][d][n]=0,state.tiles[m][f][p]=I=-1===L?2:4,import$(state.nodes[o][d][n].style,{left:p*state.dim.size+"px",top:f*state.dim.size-m*state.dim.vp+"px",zIndex:zIndex({f:m,y:f,x:p,p:0})}),state.nodes[o][d][n].classList.remove(classMap[4]),state.nodes[o][d][n].classList.add(classMap[I]),(N=state.nodes[m][f][p])&&N.parentNode&&state.nodes[m][f][p].parentNode.removeChild(state.nodes[m][f][p]),state.nodes[m][f][p]=state.nodes[o][d][n],state.nodes[o][d][n]=null,import$(t,r)):0===c||import$(t,r);renderPlayer()}}return state.tick=e-t.t,requestAnimationFrame(function(e){return firekey(e)})},requestAnimationFrame(function(e){return firekey(e)}),document.addEventListener("keyup",function(e){var t,s;if(!(e.key<37||e.key>40))return t=state.player,s=e.which-37,t.dir===s?state.player.moving=!1:void 0}),document.addEventListener("keydown",function(e){var t,s;if(!(e.key<37||e.key>40))return t=state.player,s=e.which-37,t.dir===s&&t.moving||(t.lastMoveTime=null),t.dir=s,t.moving=!0,t}),player=view.get("player"),field=view.get("field"),sample=view.get("sample"),(sample=sample.cloneNode(!0)).classList.remove("d-none"),import$(field.style,{width:state.dim.w*state.dim.size+"px",height:state.dim.h*state.dim.size+state.dim.vp*state.dim.f+"px"}),res$=[],i$=0,to$=state.dim.f;i$<to$;++i$){for(f=i$,lresult$=[],j$=0,to1$=state.dim.h;j$<to1$;++j$){for(h=j$,lresult1$=[],k$=0,to2$=state.dim.w;k$<to2$;++k$)w=k$,n=sample.cloneNode(!0),field.appendChild(n),n.classList.add(classMap[state.tiles[f][h][w]]),import$(n.style,{left:w*state.dim.size+"px",top:h*state.dim.size-f*state.dim.vp+"px",zIndex:zIndex({f:f,x:w,y:h,p:0})}),lresult1$.push(n);lresult$.push(lresult1$)}res$.push(lresult$)}state.nodes=res$,renderPlayer(),(loadLevel=function(lv){return ld$.fetch("/js/map/"+lv+".js",{},{type:"text"}).then(function(it){return console.log(eval(it))})})();
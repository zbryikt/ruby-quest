function import$(e,t){var s={}.hasOwnProperty;for(var a in t)s.call(t,a)&&(e[a]=t[a]);return e}function in$(e,t){for(var s=-1,a=t.length>>>0;++s<a;)if(e===t[s])return!0;return!1}var zIndex,classMap,state,view,renderPlayer,firekey,player,field,sample,res$,i$,to$,f,lresult$,j$,to1$,h,lresult1$,k$,to2$,w,n;for(zIndex=function(e){var t,s,a;return e.x,t=e.y,s=e.f,a=e.p,2*(s*state.dim.w*state.dim.h+t)+(a?1:0)},classMap={0:"void",1:"bedrock",2:"earth",3:"wall",4:"stool",5:"grass",6:"door",7:"key",8:"exit",9:"stair",10:"gravel",500:"sapphire"},(state={player:{x:1,y:1,f:2,item:[]},dim:{size:32,vp:12},nodes:[],tiles:[[[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1]],[[9,2,2,2,2,2,2,2],[0,2,2,2,2,2,2,2],[0,2,2,2,2,2,2,0],[0,2,2,2,2,2,2,2],[0,2,2,2,2,2,2,2],[0,2,2,2,2,2,0,2],[0,2,2,2,2,2,2,2],[9,2,2,2,2,2,2,2]],[[0,0,3,3,0,0,0,0],[0,0,0,5,0,0,4,0],[0,4,0,3,0,0,3,0],[0,10,3,3,0,3,0,0],[0,0,3,0,4,0,5,0],[0,7,3,0,0,3,0,3],[0,3,3,0,0,3,6,3],[0,0,0,0,0,3,500,3]]]}).dim.f=state.tiles.length,state.dim.h=state.tiles[0].length,state.dim.w=state.tiles[0][0].length,view=new ldView({root:document.body,handler:{field:function(){},sample:function(){},player:function(){}}}),renderPlayer=function(){return import$(player.style,{left:state.player.x*state.dim.size+"px",top:state.player.y*state.dim.size-state.player.f*state.dim.vp+"px",zIndex:zIndex({f:state.player.f,y:state.player.y,x:state.player.x,p:1})})},firekey=function(e){var t,s,a,i,r,l,n,d,o,p,f,m,$,y,u,c,v,h,x,w,k,z,g,M,I,L,N,b;if((t=state.player).moving&&(!t.lastMoveTime||e-t.lastMoveTime>100)){switch(t.lastMoveTime=e,s={x:t.x,y:t.y,f:t.f},t.dir){case 0:i=(a=[-1,0])[0],r=a[1];break;case 1:i=(a=[0,-1])[0],r=a[1];break;case 2:i=(a=[1,0])[0],r=a[1];break;case 3:i=(a=[0,1])[0],r=a[1]}if(!(isNaN(i)||(l={x:s.x+i,y:s.y+r,f:s.f},a=[t.x+i,t.y+r,s.f],n=a[0],d=a[1],o=a[2],a=[n+i,d+r,o],p=a[0],f=a[1],m=a[2],n<0||n>=state.dim.w||d<0||d>=state.dim.h||o<0))){if($=state.tiles[t.f]?state.tiles[t.f][t.y][t.x]:0,y=state.tiles[o]?state.tiles[o][d][n]:0,u=o>0?state.tiles[o-1][d][n]:1,c=state.tiles[o+1]?state.tiles[o+1][d][n]:0,in$(c,[0])&&(1===y||2===y||3===y)&&in$($,[9])&&(l.f=l.f+1,m=o=l.f,$=state.tiles[t.f][t.y][t.x],y=state.tiles[o]?state.tiles[o][d][n]:0,u=o>0?state.tiles[o-1][d][n]:1),1===y||2===y||3===y||5===y);else if(in$(y,[0])&&in$(u,[9]))l.f=l.f-1,import$(t,l);else if(in$(y,[7]))for(state.player.item.push(7),state.tiles[o][d][n]=0,state.nodes[o][d][n].parentNode.removeChild(state.nodes[o][d][n]),import$(t,l),v=0,h=state.dim.f;v<h;++v)for(x=v,w=0,k=state.dim.h;w<k;++w)for(z=w,g=0,M=state.dim.w;g<M;++g)I=g,6===state.tiles[x][z][I]&&(state.tiles[x][z][I]=8,state.nodes[x][z][I].classList.remove(classMap[6]),state.nodes[x][z][I].classList.add(classMap[8]));else in$(y,[500])?(state.tiles[o][d][n]=0,state.nodes[o][d][n].parentNode.removeChild(state.nodes[o][d][n]),import$(t,l)):in$(y,[4])?0!==(a=state.tiles[o][f][p])&&5!==a||state.tiles[o-1]&&in$(state.tiles[o-1][f][p],[9])||(m=o+(L=o>0&&in$(state.tiles[o-1][f][p],[0])?-1:0),state.tiles[o][d][n]=0,state.tiles[m][f][p]=N=-1===L?2:4,import$(state.nodes[o][d][n].style,{left:p*state.dim.size+"px",top:f*state.dim.size-m*state.dim.vp+"px",zIndex:zIndex({f:m,y:f,x:p,p:0})}),state.nodes[o][d][n].classList.remove(classMap[4]),state.nodes[o][d][n].classList.add(classMap[N]),(b=state.nodes[m][f][p])&&b.parentNode&&state.nodes[m][f][p].parentNode.removeChild(state.nodes[m][f][p]),state.nodes[m][f][p]=state.nodes[o][d][n],state.nodes[o][d][n]=null,import$(t,l)):in$(u,[0])||import$(t,l);renderPlayer()}}return state.tick=e-t.t,requestAnimationFrame(function(e){return firekey(e)})},requestAnimationFrame(function(e){return firekey(e)}),document.addEventListener("keyup",function(e){var t,s;if(!(e.key<37||e.key>40))return t=state.player,s=e.which-37,t.dir===s?state.player.moving=!1:void 0}),document.addEventListener("keydown",function(e){var t,s;if(!(e.key<37||e.key>40))return t=state.player,s=e.which-37,t.dir===s&&t.moving||(t.lastMoveTime=null),t.dir=s,t.moving=!0,t}),player=view.get("player"),field=view.get("field"),(sample=(sample=view.get("sample")).cloneNode(!0)).classList.remove("d-none"),import$(field.style,{width:state.dim.w*state.dim.size+"px",height:state.dim.h*state.dim.size+state.dim.vp*state.dim.f+"px"}),res$=[],i$=0,to$=state.dim.f;i$<to$;++i$){for(f=i$,lresult$=[],j$=0,to1$=state.dim.h;j$<to1$;++j$){for(h=j$,lresult1$=[],k$=0,to2$=state.dim.w;k$<to2$;++k$)w=k$,n=sample.cloneNode(!0),field.appendChild(n),n.classList.add(classMap[state.tiles[f][h][w]]),import$(n.style,{left:w*state.dim.size+"px",top:h*state.dim.size-f*state.dim.vp+"px",zIndex:zIndex({f:f,x:w,y:h,p:0})}),lresult1$.push(n);lresult$.push(lresult1$)}res$.push(lresult$)}state.nodes=res$,renderPlayer();